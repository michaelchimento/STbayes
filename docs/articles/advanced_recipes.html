<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced recipes ‚Ä¢ STbayes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced recipes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">STbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced_recipes.html">Advanced recipes</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started with STbayes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced recipes</h1>
            
      

      <div class="d-none name"><code>advanced_recipes.Rmd</code></div>
    </div>

    
    
<p>This vignette gives some examples of more advanced/involved uses of
STbayes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="individual-level-variables-ilvs">Individual-level variables (ILVs)<a class="anchor" aria-label="anchor" href="#individual-level-variables-ilvs"></a>
</h2>
<p>Individual-level variables can be either constant (e.g.¬†age, sex) or
time-varying (e.g.¬†body condition).</p>
<p>Below is a toy data-set of two trials, each with 3 individuals with
constant ILVs age, sex and weight.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    t_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">networks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>    kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    inverse_distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.5</span>, <span class="fl">.25</span>, <span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ILV_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># continuous variables should be normalized</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># Factor ILVs must be input as numeric</span></span>
<span>    weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">.25</span>, <span class="fl">.3</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">.2</span>, <span class="op">-</span><span class="fl">.4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The data-frame ILV_c holds the values for each individual. The
formatting of <code>id</code> should match the event_data and networks
data-frames. At the moment, ILVs can be continuous or binary. You should
normalize continuous variables, and binary variables should be coded as
0, 1. I plan to expand this to multi-category factors, but for the
moment you must directly edit the Stan code to use these.</p>
<p>We need to explicitly tell STbayes which variables are additive
(acting independently on intrinsic or social rates) and multiplicative
(same effect estimated for intrinsic and social rates). Below, I have
specified age as acting independently on the intrinsic and social rate,
sex as acting only on the social rate, and weight as a multiplicative
effect. Thus, two betas will be estimated for age, and a single beta
will be estimated for sex and weight.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### explicitly setting which variables are additive and multiplicative ####</span></span>
<span><span class="va">STb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span></span>
<span>    event_data <span class="op">=</span> <span class="va">event_data</span>,</span>
<span>    networks <span class="op">=</span> <span class="va">networks</span>,</span>
<span>    ILV_c <span class="op">=</span> <span class="va">ILV_c</span>,</span>
<span>    ILVi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>, <span class="co"># estimate effects of constant ILV 'age' and time-varying ILV 'dist_from_resource' on asocial learning rates</span></span>
<span>    ILVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>, <span class="co"># Use only 'sex' for social learning</span></span>
<span>    ILVm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span> <span class="co"># Use weight for multiplicative effect on asocial and social learning</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as point estimates üìç</span></span>
<span><span class="co">#&gt; Constant ILV supplied.</span></span>
<span><span class="co">#&gt; User input indicates static network(s). If dynamic, include 'time' column.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 6 individuals across 2 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 3 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 2 networks: kin, inverse_distance</span></span>
<span><span class="co">#&gt; ILV for asocial learning: age</span></span>
<span><span class="co">#&gt; ILV for social learning: age, sex</span></span>
<span><span class="co">#&gt; multiplicative model ILV: weight</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span></span>
<span><span class="va">model_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">STb_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span></code></pre></div>
<div class="section level3">
<h3 id="time-varying-ilvs">Time-varying ILVs<a class="anchor" aria-label="anchor" href="#time-varying-ilvs"></a>
</h3>
<p>Below we add distance from resource as a time-varying ILV. Similar to
dynamic networks, these need to be summarized per inter-event interval.
For example, the value of <code>dist_from_resource</code> at
<code>time=1</code> should reflect the average distance of the
individual to the resource from the start of the observation period to
the first event.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ILV_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    dist_from_resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">STb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span></span>
<span>    event_data <span class="op">=</span> <span class="va">event_data</span>,</span>
<span>    networks <span class="op">=</span> <span class="va">networks</span>,</span>
<span>    ILV_c <span class="op">=</span> <span class="va">ILV_c</span>,</span>
<span>    ILV_tv <span class="op">=</span> <span class="va">ILV_tv</span>,</span>
<span>    ILVi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"dist_from_resource"</span><span class="op">)</span>,</span>
<span>    ILVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span><span class="op">)</span>,</span>
<span>    ILVm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as point estimates üìç</span></span>
<span><span class="co">#&gt; Constant ILV supplied.</span></span>
<span><span class="co">#&gt; Time-varying ILV supplied.</span></span>
<span><span class="co">#&gt; User input indicates static network(s). If dynamic, include 'time' column.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 6 individuals across 2 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 3 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 2 networks: kin, inverse_distance</span></span>
<span><span class="co">#&gt; ILV for asocial learning: age, dist_from_resource</span></span>
<span><span class="co">#&gt; ILV for social learning: sex</span></span>
<span><span class="co">#&gt; multiplicative model ILV: weight</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span></span>
<span><span class="va">model_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">STb_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span></code></pre></div>
<p>Here, we will include it as an additive effect on the intrinsic rate
along with age.</p>
</div>
</div>
<div class="section level2">
<h2 id="transmission-weights">Transmission weights<a class="anchor" aria-label="anchor" href="#transmission-weights"></a>
</h2>
</div>
<div class="section level2">
<h2 id="varying-effects-by-individual">Varying effects by individual<a class="anchor" aria-label="anchor" href="#varying-effects-by-individual"></a>
</h2>
<p>You may apply varying effects for each individual for the intrinsic
rate (lambda_0), social learning rate (s) and any of the ILVs. You do
this by specifying specific parameter names using the argument
<code>veff_ID</code> in the call to <code><a href="../reference/generate_STb_model.html">generate_STb_model()</a></code> or
<code>generate_STb_asocial_model</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span>, veff_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda_0"</span>, <span class="st">"s"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For lambda_0 and s, varying effects are added onto the main effect on
the log scale. For example, the model would calculate a vector of
lambda_0 values for each individual in the
<code>transformed parameters</code> block:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mo>log</mo><msub><mi>Œª</mi><mn>0</mn></msub></mrow></msub><mo>+</mo><msub><mi>ùêØ</mi><mrow><mtext mathvariant="normal">ID</mtext><mo>,</mo><msub><mi>Œª</mi><mn>0</mn></msub></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\exp\left(\mu_{\log \lambda_0} + \boldsymbol{v}_{\text{ID}, \lambda_0}\right)
</annotation></semantics></math> and use those values when calculating
the likelihood in the <code>model</code> block.</p>
</div>
<div class="section level2">
<h2 id="other-model-types-oada-and-dtada">Other model types: OADA and dTADA<a class="anchor" aria-label="anchor" href="#other-model-types-oada-and-dtada"></a>
</h2>
</div>
<div class="section level2">
<h2 id="edge-weight-uncertainty">Edge weight uncertainty<a class="anchor" aria-label="anchor" href="#edge-weight-uncertainty"></a>
</h2>
<p>Rather than using point estimates for edge weights, it is possible to
import posterior distributions of edge weights from bayesian network
models, such as those fit by the <a href="https://github.com/JHart96/bisonR/tree/main" class="external-link">bisonr package</a> or
the <a href="https://github.com/ctross/STRAND/tree/main" class="external-link">STRAND
package</a>. This is done by providing single fits (or a list of fits)
to <code><a href="../reference/import_user_STb.html">import_user_STb()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bisonr_fit</span> <span class="op">&lt;-</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">bisonr_fit</span></span>
<span></span>
<span><span class="co"># network has 10 individuals, create mock diffusion data</span></span>
<span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">101</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    t_end <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="va">event_data</span>, networks <span class="op">=</span> <span class="va">bisonr_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as posterior distributions üåà</span></span>
<span><span class="co">#&gt; No ILV supplied.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 10 individuals across 1 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 10 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 1 networks: net1</span></span>
<span><span class="co">#&gt; ILV for asocial learning: ILVabsent</span></span>
<span><span class="co">#&gt; ILV for social learning: ILVabsent</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span>
<span></span>
<span><span class="co"># it's also possible to do multi-network models. </span></span>
<span><span class="co"># here i add two of the same just to illustrate</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="va">event_data</span>, networks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">bisonr_fit</span>, <span class="va">bisonr_fit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied a list of Bayesian network fits [üåà , üåà]</span></span>
<span><span class="co">#&gt; No ILV supplied.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 10 individuals across 1 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 10 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 2 networks: net1, net2</span></span>
<span><span class="co">#&gt; ILV for asocial learning: ILVabsent</span></span>
<span><span class="co">#&gt; ILV for social learning: ILVabsent</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="complex-transmission">Complex transmission<a class="anchor" aria-label="anchor" href="#complex-transmission"></a>
</h2>
</div>
<div class="section level2">
<h2 id="setting-priors">Setting priors<a class="anchor" aria-label="anchor" href="#setting-priors"></a>
</h2>
<p>You might want to customize the priors of your model. Here are the
default priors:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        log_lambda0 <span class="op">=</span> <span class="st">"normal(-4, 2)"</span>, <span class="co"># intrinsic rate</span></span>
<span>        log_sprime <span class="op">=</span> <span class="st">"normal(-4, 2)"</span>, <span class="co"># social transmission rate</span></span>
<span>        beta_ILV <span class="op">=</span> <span class="st">"normal(0,1)"</span>, <span class="co"># beta coefficients for ILVs</span></span>
<span>        log_f <span class="op">=</span> <span class="st">"normal(0,1)"</span>, <span class="co"># exponent parameter under freqdep_f models</span></span>
<span>        k_raw <span class="op">=</span> <span class="st">"normal(0,3)"</span>, <span class="co"># k parameter under freqdep_k models</span></span>
<span>        z_ID <span class="op">=</span> <span class="st">"normal(0,1)"</span>, <span class="co"># varying effects</span></span>
<span>        sigma_ID <span class="op">=</span> <span class="st">"normal(0,1)"</span>, <span class="co"># SD of varying effects</span></span>
<span>        rho_ID <span class="op">=</span> <span class="st">"lkj_corr_cholesky(3)"</span>, <span class="co"># LKJ prior for veff corr matrix</span></span>
<span>        gamma <span class="op">=</span> <span class="st">"normal(0,1)"</span> <span class="co"># gamma parameter for Weibull intrinsic hazard model</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>To adjust any one of them, call generate_STb_model and provide a
named list of those you wish to change in the priors argument. The
distributions should be written with the usual Stan convention. You only
need to supply those which you wish to change. For example, you might
want to tighten your priors on intrinsic rate, social rate and beta
params for ILVs.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="fu">STbayes</span><span class="fu">::</span><span class="va">event_data</span>, <span class="fu">STbayes</span><span class="fu">::</span><span class="va">edge_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as point estimates üìç</span></span>
<span><span class="co">#&gt; No ILV supplied.</span></span>
<span><span class="co">#&gt; User input indicates static network(s). If dynamic, include 'time' column.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 50 individuals across 1 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 50 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 1 networks: assoc</span></span>
<span><span class="co">#&gt; ILV for asocial learning: ILVabsent</span></span>
<span><span class="co">#&gt; ILV for social learning: ILVabsent</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span>, priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     log_lambda0 <span class="op">=</span> <span class="st">"normal(-4, 1)"</span>,</span>
<span>     log_sprime <span class="op">=</span> <span class="st">"uniform(-4, 1)"</span>,</span>
<span>     beta_ILV <span class="op">=</span> <span class="st">"normal(0, .5)"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 1)</span></span>
<span><span class="co">#&gt; log_sprime ~ uniform(-4, 1)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0, .5)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span></code></pre></div>
<p>At the moment, the function will always print all priors that are
possible to specify, regardless of the type of model you are creating.
At least this makes it easy to reference the names when you need
them.</p>
</div>
<div class="section level2">
<h2 id="import-nbda-data-objects">Import NBDA data objects<a class="anchor" aria-label="anchor" href="#import-nbda-data-objects"></a>
</h2>
<p>STbayes is compatible with most NBDA objects. The function will try
to figure out what was meant to be done with ILVs. However, some
features of STbayes require using import_user_STb and I generally
encourage you to use the new data format. Read in an NBDA object (taken
from Tutorial 4.1 from <a href="https://doi.org/10.1111/1365-2656.13307" class="external-link">Hasenjager et
al.¬†2021</a>) like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nbdaData_cTADA</span> <span class="op">&lt;-</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">tutorial4_1</span></span>
<span><span class="va">data_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/import_NBDA_STb.html">import_NBDA_STb</a></span><span class="op">(</span><span class="va">nbdaData_cTADA</span><span class="op">)</span></span>
<span><span class="co">#&gt; üëâ This function is convenient, but there's more flexibility and functionality available using the import_user_STb() function.</span></span>
<span><span class="co">#&gt; Loading required namespace: NBDA</span></span>
<span><span class="co">#&gt; ü§î This NBDA object is likely in TADA format.</span></span>
<span><span class="co">#&gt; ‚ñë‚ñí‚ñì‚ñà‚ñ∫‚îÄ‚ïê Sanity check ‚ïê‚îÄ‚óÑ‚ñà‚ñì‚ñí‚ñë</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 30 individuals across 1 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 30 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 1 networks: default</span></span>
<span><span class="co">#&gt; ILV for asocial learning: stAge</span></span>
<span><span class="co">#&gt; ILV for social learning: stAge</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; ü§î Does that seem right to you?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 25</span></span>
<span><span class="co">#&gt;  $ K            : int 1</span></span>
<span><span class="co">#&gt;  $ P            : int 30</span></span>
<span><span class="co">#&gt;  $ N            : num [1(1d)] 30</span></span>
<span><span class="co">#&gt;  $ N_c          : num [1(1d)] 0</span></span>
<span><span class="co">#&gt;  $ T            : num [1(1d)] 28</span></span>
<span><span class="co">#&gt;  $ t            : num [1, 1:30] 12 27 8 20 14 18 17 4 15 28 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "1"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:30] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;  $ T_max        : num 28</span></span>
<span><span class="co">#&gt;  $ time         : num [1, 1:30] 334 499 310 377 338 374 367 266 340 567 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "1"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:30] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;  $ time_max     : num [1(1d)] 568</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "1"</span></span>
<span><span class="co">#&gt;  $ Q            : num 30</span></span>
<span><span class="co">#&gt;  $ D            : num [1, 1:28] 234 18 10 4 7 23 2 12 3 13 ...</span></span>
<span><span class="co">#&gt;  $ D_int        : num [1, 1:28] 234 18 10 4 7 23 2 12 3 13 ...</span></span>
<span><span class="co">#&gt;  $ ind_id       : num [1, 1:30] 26 29 30 8 19 21 22 3 14 12 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "1"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:30] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;  $ Zn           : num [1, 1:28, 1:30] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ prop_k       : NULL</span></span>
<span><span class="co">#&gt;  $ high_res     : logi FALSE</span></span>
<span><span class="co">#&gt;  $ directed     : logi FALSE</span></span>
<span><span class="co">#&gt;  $ Z            : num [1, 1:28, 1:30] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ ILV_stAge    : num [1:30] -1.2921 -0.1631 0.0251 -1.1981 -0.8687 ...</span></span>
<span><span class="co">#&gt;  $ ILVi_names   : chr "stAge"</span></span>
<span><span class="co">#&gt;  $ ILVs_names   : chr "stAge"</span></span>
<span><span class="co">#&gt;  $ ILVm_names   : chr "ILVabsent"</span></span>
<span><span class="co">#&gt;  $ network_names: chr "default"</span></span>
<span><span class="co">#&gt;  $ A            : num [1, 1, 1:28, 1:30, 1:30] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ N_networks   : int 1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Chimento.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
