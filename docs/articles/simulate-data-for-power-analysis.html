<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulate data for power analyses • STbayes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate data for power analyses">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">STbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced_recipes.html">Advanced recipes</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started with STbayes</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-data-for-power-analysis.html">Simulate data for power analyses</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate data for power analyses</h1>
            
      

      <div class="d-none name"><code>simulate-data-for-power-analysis.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://michaelchimento.github.io/STbayes">STbayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'igraph'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     decompose, spectrum</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:igraph':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     as_data_frame, groups, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>This vignette will introduce functions to simulate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n\geq1</annotation></semantics></math>
diffusion trials. This can be used as a basis for power analyses.
Afterwards, you can fit STbayes models to the stimulate data to ask,
given a population size, relative effect of social transmission, and ILV
effects, how many trials are necessary to reliably support a full model
over an asocial model, or detect any of the effects?</p>
<p>First, let’s define a the simulation function for a single diffusion
trial:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_trial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial_num</span>, <span class="va">obs_duration</span>, <span class="va">g</span>, <span class="va">parameter_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Initialize dataframe to store the time of acquisition data</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>, time <span class="op">=</span> <span class="va">obs_duration</span> <span class="op">+</span> <span class="fl">1</span>, t_end <span class="op">=</span> <span class="va">obs_duration</span>, trial <span class="op">=</span> <span class="va">trial_num</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Simulate the diffusion</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">obs_duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># identify knowledgeable individuals</span></span>
<span>        <span class="va">informed</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="va">obs_duration</span>, <span class="st">"id"</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co"># identify naive individuals</span></span>
<span>        <span class="va">potential_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span></span>
<span>        <span class="va">potential_learners</span> <span class="op">&lt;-</span> <span class="va">potential_learners</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">potential_learners</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="va">informed</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co"># break the loop if no one left to learn</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">potential_learners</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">results</span><span class="op">$</span><span class="va">t_end</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># minus 1 so t_end=last learner</span></span>
<span>            <span class="kw">break</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># calculate the hazard for potential learners</span></span>
<span>        <span class="va">learning_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">potential_learners</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">neighbors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/neighbors.html" class="external-link">neighbors</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">x</span><span class="op">)</span></span>
<span>            <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">neighbors</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="va">informed</span><span class="op">)</span></span>
<span>            <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">parameter_values</span><span class="op">[</span><span class="va">parameter_values</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">x</span>, <span class="st">"lambda_0"</span><span class="op">]</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="va">parameter_values</span><span class="op">[</span><span class="va">parameter_values</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">x</span>, <span class="st">"s_prime"</span><span class="op">]</span> <span class="op">*</span> <span class="va">C</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># convert hazard to probability</span></span>
<span>        <span class="va">learning_probs</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">learning_rates</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># for each potential learner, determine whether they learn the behavior</span></span>
<span>        <span class="va">learners_this_step</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">potential_learners</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">learning_probs</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># update their time of acquisition</span></span>
<span>        <span class="va">new_learners</span> <span class="op">&lt;-</span> <span class="va">potential_learners</span><span class="op">[</span><span class="va">learners_this_step</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="va">new_learners</span>, <span class="st">"time"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function accepts an integer representing the trial number, an
integer representing the length of the observation period, an igraph
object defining the social network, and a data-frame containing learning
parameter values. It first creates a data-frame to hold the results of
when each individual experienced an event. Then it loops through
time-steps, This is a pre-determined observation time to prevent
infinite loops, in case you set learning rates to 0. Any individual who
doesn’t learn within the observation period will be recorded as
censored. Each time step, we check who is already informed (experienced
the event), and then who is still a potential learner (hasn’t
experienced the event). If all individuals have experienced the event,
the loop breaks and the function returns the data-frame. Otherwise, we
calculate learning rates, transform them into probabilities, and the
potential learners might experience the event according to Bernoulli
trials using those probabilities. Finally, we record the times of those
events.</p>
<p>We want to run more than one trial, so we can embed this function in
a larger one that lets us conveniently run many trials:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_sims</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num_trials</span>, <span class="va">obs_duration</span>, <span class="va">parameter_values</span>, <span class="va">N</span>, <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># storage for all trials</span></span>
<span>    <span class="va">all_event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        t_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">all_edge_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        focal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        assoc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">trial</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_trials</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># create random regular graph</span></span>
<span>        <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/sample_k_regular.html" class="external-link">sample_k_regular</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">k</span>, directed <span class="op">=</span> <span class="cn">FALSE</span>, multiple <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span></span>
<span>        <span class="va">results</span> <span class="op">=</span> <span class="fu">diffusion_trial</span><span class="op">(</span><span class="va">trial</span>, <span class="va">obs_duration</span>, <span class="va">g</span>, <span class="va">parameter_values</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># create event + network data and append to cumulative dataframes</span></span>
<span>        <span class="va">event_data</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>        <span class="va">all_event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">all_event_data</span>, <span class="va">event_data</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">edge_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/as_edgelist.html" class="external-link">as_edgelist</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">edge_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"focal"</span>, <span class="st">"other"</span><span class="op">)</span></span>
<span>        <span class="va">edge_list</span><span class="op">$</span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va">trial</span></span>
<span>        <span class="va">edge_list</span><span class="op">$</span><span class="va">assoc</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># assign e_ij=1 since this is just an edge list</span></span>
<span>        <span class="va">all_edge_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">all_edge_list</span>, <span class="va">edge_list</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Trial"</span>, <span class="va">trial</span>, <span class="st">"completed.\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># package up data into list and return it</span></span>
<span>    <span class="va">final_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"event_data"</span> <span class="op">=</span> <span class="va">all_event_data</span>,</span>
<span>        <span class="st">"networks"</span> <span class="op">=</span> <span class="va">all_edge_list</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">final_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function creates data-frames to accumulate the results in, and
then for each trial, generates a random-regular network using arguments
<code>N</code> (pop size) and <code>k</code> (degree). It then runs the
diffusion trial, accumulates the results, and returns a list of two
data-frames, one with the event data, and the other with networks. These
are already formatted for use with STbayes.</p>
<p>Let’s define our parameters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameters</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># population size</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># degree</span></span>
<span><span class="va">log_lambda_0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">6</span></span>
<span><span class="va">log_sprime</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4</span> </span>
<span><span class="va">obs_duration</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">num_trials</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co">#learning parameters</span></span>
<span><span class="va">parameter_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>,</span>
<span>    lambda_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_lambda_0</span><span class="op">)</span>,</span>
<span>    s_prime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_sprime</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameter_values</span><span class="op">$</span><span class="va">s</span> <span class="op">=</span> <span class="va">parameter_values</span><span class="op">$</span><span class="va">s_prime</span><span class="op">/</span><span class="va">parameter_values</span><span class="op">$</span><span class="va">lambda_0</span></span></code></pre></div>
<p>Note that we are defining the parameters on the log scale.
Furthermore, we do not define the strength of social information
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>)
directly, but rather define the log intrinsic rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\lambda_0</annotation></semantics></math>),
and the log social transmission rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">s'</annotation></semantics></math>).
We can then derive s by dividing the two. If we set
<code>log_lambda_0==s'</code>, then the relative strength of social
transmission would be 1. Now, we can run the simulations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_sims</span><span class="op">(</span><span class="va">num_trials</span>, <span class="va">obs_duration</span>, <span class="va">parameter_values</span>, <span class="va">N</span>, <span class="va">k</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trial1completed.</span></span>
<span><span class="co">#&gt; Trial2completed.</span></span>
<span><span class="co">#&gt; Trial3completed.</span></span>
<span><span class="co">#&gt; Trial4completed.</span></span>
<span><span class="co">#&gt; Trial5completed.</span></span>
<span><span class="co">#&gt; Trial6completed.</span></span>
<span><span class="co">#&gt; Trial7completed.</span></span>
<span><span class="co">#&gt; Trial8completed.</span></span>
<span><span class="co">#&gt; Trial9completed.</span></span>
<span><span class="co">#&gt; Trial10completed.</span></span></code></pre></div>
<p>Now that we have our results, we can feed these into STbayes and fit
models to them. Let’s test that we correctly support the social
transmission model over the asocial constrained model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import data</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span></span>
<span>    event_data <span class="op">=</span> <span class="va">results</span><span class="op">[[</span><span class="st">"event_data"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    networks <span class="op">=</span> <span class="va">results</span><span class="op">[[</span><span class="st">"networks"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as point estimates 📍</span></span>
<span><span class="co">#&gt; No ILV supplied.</span></span>
<span><span class="co">#&gt; User input indicates static network(s). If dynamic, include 'time' column.</span></span>
<span><span class="co">#&gt; ░▒▓█►─═ Sanity check ═─◄█▓▒░</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 30 individuals across 10 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 30 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 1 networks: assoc</span></span>
<span><span class="co">#&gt; ILV for asocial learning: ILVabsent</span></span>
<span><span class="co">#&gt; ILV for social learning: ILVabsent</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; 🤔 Does that seem right to you?</span></span>
<span></span>
<span><span class="co"># fit full model</span></span>
<span><span class="va">model_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span>
<span><span class="va">fit_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model_full</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected N_veff = 0</span></span>
<span><span class="co">#&gt; ⏳ Sampling...</span></span>
<span><span class="co">#&gt; Running MCMC with 1 chain...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 finished in 4.2 seconds.</span></span>
<span><span class="co">#&gt; 🫴 Use STb_save() to save the fit and chain csvs to a single RDS file. Or don't!</span></span>
<span></span>
<span><span class="co"># fit constrained model</span></span>
<span><span class="va">model_asoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span>, model_type <span class="op">=</span> <span class="st">"asocial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span>
<span><span class="va">fit_asoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model_asoc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected N_veff = 0</span></span>
<span><span class="co">#&gt; ⏳ Sampling...</span></span>
<span><span class="co">#&gt; Running MCMC with 1 chain...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 finished in 0.5 seconds.</span></span>
<span><span class="co">#&gt; 🫴 Use STb_save() to save the fit and chain csvs to a single RDS file. Or don't!</span></span>
<span></span>
<span><span class="co">#compare</span></span>
<span><span class="va">loo_output</span> <span class="op">=</span> <span class="fu"><a href="../reference/STb_compare.html">STb_compare</a></span><span class="op">(</span><span class="va">fit_full</span>, <span class="va">fit_asoc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calculating LOO-PSIS.</span></span>
<span><span class="co">#&gt; Comparing models.</span></span>
<span><span class="co">#&gt; Calculating pareto-k diagnostic (only for loo-psis).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">loo_output</span><span class="op">$</span><span class="va">comparison</span><span class="op">)</span></span>
<span><span class="co">#&gt;          elpd_diff se_diff</span></span>
<span><span class="co">#&gt; fit_full    0.0       0.0 </span></span>
<span><span class="co">#&gt; fit_asoc -193.6      14.5</span></span></code></pre></div>
<p>Given enough trials, and a large enough population size, the social
model should be correctly supported. A power analysis table with
differing numbers of individuals and trials is available in the
manuscript.</p>
<div class="section level2">
<h2 id="include-ilvs">Include ILVs<a class="anchor" aria-label="anchor" href="#include-ilvs"></a>
</h2>
<p>Finally, let’s add a constant ILV effect. First, let’s create a few
different types of ILVs. STbayes supports boolean, continuous and
categorical ILVs. We will apply an effect of the continuous ILV to
social transmission and re-run the simulations. Note that now we inc</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ILVconstant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>,</span>
<span>    bool_ILV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, <span class="co"># boolean ILV</span></span>
<span>    cont_ILV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># continuous ILV</span></span>
<span>    cat_ILV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># categorical with 4 levels</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ilv_beta</span> <span class="op">=</span> <span class="fl">1.5</span> <span class="co">#effect </span></span>
<span><span class="va">parameter_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>,</span>
<span>        lambda_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_lambda_0</span><span class="op">)</span>,</span>
<span>        s_prime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_sprime</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">ilv_beta</span> <span class="op">*</span> <span class="va">ILVconstant</span><span class="op">$</span><span class="va">cont_ILV</span><span class="op">)</span>  <span class="co">#apply continuous ILV to SL</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">parameter_values</span><span class="op">$</span><span class="va">s</span> <span class="op">=</span> <span class="va">parameter_values</span><span class="op">$</span><span class="va">s_prime</span><span class="op">/</span><span class="va">parameter_values</span><span class="op">$</span><span class="va">lambda_0</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_sims</span><span class="op">(</span><span class="va">num_trials</span>, <span class="va">obs_duration</span>, <span class="va">parameter_values</span>, <span class="va">N</span>, <span class="va">k</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trial1completed.</span></span>
<span><span class="co">#&gt; Trial2completed.</span></span>
<span><span class="co">#&gt; Trial3completed.</span></span>
<span><span class="co">#&gt; Trial4completed.</span></span>
<span><span class="co">#&gt; Trial5completed.</span></span>
<span><span class="co">#&gt; Trial6completed.</span></span>
<span><span class="co">#&gt; Trial7completed.</span></span>
<span><span class="co">#&gt; Trial8completed.</span></span>
<span><span class="co">#&gt; Trial9completed.</span></span>
<span><span class="co">#&gt; Trial10completed.</span></span></code></pre></div>
<p>Now we can import the data into STbayes. Note that we need to include
ILV_c data-frame, and specify that the continuous ILV should be applied
as an additive effect to social learning.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span></span>
<span>    event_data <span class="op">=</span> <span class="va">results</span><span class="op">[[</span><span class="st">"event_data"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    networks <span class="op">=</span> <span class="va">results</span><span class="op">[[</span><span class="st">"networks"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    ILV_c <span class="op">=</span> <span class="va">ILVconstant</span>,</span>
<span>    ILVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cont_ILV"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; User supplied edge weights as point estimates 📍</span></span>
<span><span class="co">#&gt; Constant ILV supplied.</span></span>
<span><span class="co">#&gt; User input indicates static network(s). If dynamic, include 'time' column.</span></span>
<span><span class="co">#&gt; ░▒▓█►─═ Sanity check ═─◄█▓▒░</span></span>
<span><span class="co">#&gt; User provided data about:</span></span>
<span><span class="co">#&gt; 30 individuals across 10 independent diffusions (trials).</span></span>
<span><span class="co">#&gt; There were 30 individuals in each trial.</span></span>
<span><span class="co">#&gt; User supplied 1 networks: assoc</span></span>
<span><span class="co">#&gt; ILV for asocial learning: ILVabsent</span></span>
<span><span class="co">#&gt; ILV for social learning: cont_ILV</span></span>
<span><span class="co">#&gt; multiplicative model ILV: ILVabsent</span></span>
<span><span class="co">#&gt; 🤔 Does that seem right to you?</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating cTADA type model with the following default priors:</span></span>
<span><span class="co">#&gt; log_lambda0 ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; log_sprime ~ normal(-4, 2)</span></span>
<span><span class="co">#&gt; beta_ILV ~ normal(0,1)</span></span>
<span><span class="co">#&gt; log_f ~ normal(0,1)</span></span>
<span><span class="co">#&gt; k_raw ~ normal(0,3)</span></span>
<span><span class="co">#&gt; z_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; sigma_ID ~ normal(0,1)</span></span>
<span><span class="co">#&gt; rho_ID ~ lkj_corr_cholesky(3)</span></span>
<span><span class="co">#&gt; gamma ~ normal(0,1)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected N_veff = 0</span></span>
<span><span class="co">#&gt; ⏳ Sampling...</span></span>
<span><span class="co">#&gt; Running MCMC with 1 chain...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 finished in 5.7 seconds.</span></span>
<span><span class="co">#&gt; 🫴 Use STb_save() to save the fit and chain csvs to a single RDS file. Or don't!</span></span>
<span><span class="fu"><a href="../reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;            Parameter Median   MAD CI_Lower CI_Upper ess_bulk ess_tail  Rhat</span></span>
<span><span class="co">#&gt; 1  log_lambda_0_mean -6.048 0.216   -6.504   -5.628  334.893  284.693 1.002</span></span>
<span><span class="co">#&gt; 2   log_s_prime_mean -4.055 0.081   -4.187   -3.897  353.473  247.560 1.007</span></span>
<span><span class="co">#&gt; 4           lambda_0  0.002 0.001    0.001    0.003  334.869  284.693 1.001</span></span>
<span><span class="co">#&gt; 5                  s  7.386 1.866    4.343   11.806  299.387  297.749 1.006</span></span>
<span><span class="co">#&gt; 3 beta_ILVs_cont_ILV  1.384 0.071    1.266    1.507  311.718  351.954 1.003</span></span>
<span><span class="co">#&gt; 6      percent_ST[1]  0.846 0.019    0.801    0.879  284.512  283.954 1.002</span></span></code></pre></div>
<p>The estimated beta should be in the neighborhood of the effect that
we defined. There will be shrinkage, as the default prior for ILV betas
is <code>normal(0,1)</code>. This can be adjusted using the priors
argument of <code><a href="../reference/generate_STb_model.html">generate_STb_model()</a></code>. We suggest not to use a
very uninformative prior, as this can quickly cause model identification
problems. If you find that you’re unable to recover the parameter value,
a larger sample size is probably needed. This vignette is just a
starting point, but you could equally apply the other types of
variables, or even add varying effects to either rates or ILVs using the
veff_ID argument in <code><a href="../reference/generate_STb_model.html">generate_STb_model()</a></code>.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Chimento.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
