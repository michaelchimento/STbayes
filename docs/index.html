<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Organize, Generate, Fit, and Analyze Bayesian Models of Social Transmission • STbayes</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Organize, Generate, Fit, and Analyze Bayesian Models of Social Transmission">
<meta name="description" content="STbayes is a flexible tool for building and running Bayesian models of social transmission over networks, inspired by the network-based diffusion analysis (NBDA) framework. STbayes builds and compiles customized STAN programs based on the user's input. These models estimate rates of asocial and social transmission that can be affected by individual level variables. Models can be optionally fitted with random effects to account for inter-individual variation. The model can accept static or dynamic networks, and can compare multiple networks if supplied. Furthermore, networks may be supplied with point-estimate edge weights, or posterior distributions of edgeweights, allowing for propagation of uncertainty from network inference. The package accepts either raw data supplied by the user, or NBDA objects exported from the NBDA package.">
<meta property="og:description" content="STbayes is a flexible tool for building and running Bayesian models of social transmission over networks, inspired by the network-based diffusion analysis (NBDA) framework. STbayes builds and compiles customized STAN programs based on the user's input. These models estimate rates of asocial and social transmission that can be affected by individual level variables. Models can be optionally fitted with random effects to account for inter-individual variation. The model can accept static or dynamic networks, and can compare multiple networks if supplied. Furthermore, networks may be supplied with point-estimate edge weights, or posterior distributions of edgeweights, allowing for propagation of uncertainty from network inference. The package accepts either raw data supplied by the user, or NBDA objects exported from the NBDA package.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">STbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/advanced_recipes.html">Advanced recipes</a></li>
    <li><a class="dropdown-item" href="articles/getting_started.html">Getting started with STbayes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img src="reference/figures/stbayes_banner2.png" alt="banner"><!-- badges: start --><!-- badges: end --></p>
<p><strong>STbayes</strong> (SocialTransmissionbayes[ian]) is a package for building and running Bayesian inferential models of social transmission across static or dynamic networks. Users may supply their own data in formats given below, or import nbdaData objects directly from the <a href="https://github.com/whoppitt/NBDA" class="external-link">NBDA package</a>.</p>
<p>STbayes can currently accomodate: - cTADA (acquisition time known) and OADA (only acquisition order known) model types. - static and dynamic networks. - multi-network comparison (with static or dynamic networks). - multiple trials with the same set, subsets, or different sets of individuals. - constant and time-varying ILVs for additive and multiplicative transmission models. - varying effects by individual for strength of social transmission, baseline hazard rates, and other user defined ILVs. - Easy workflow for ELPD (loo-psis, waic) model comparison. - propagation of uncertainty from network measures to transmission model - modeling of complex transmission and contagion</p>
<p>This package is under development and is not guaranteed to work.</p>
<p><strong>Table of contents:</strong></p>
<ol style="list-style-type: decimal">
<li><a href="#Installation">Installation</a></li>
<li><a href="#Examples">Examples</a></li>
<li><a href="#Recover">Recover parameter values from simulated data</a></li>
<li><a href="#Compare-full-asocial">Compare full and asocial models</a></li>
<li><a href="#Import-own">Import your own data</a></li>
<li><a href="#Varying-effects">Varying effects by individual</a></li>
<li><a href="#Import-NBDA">Import data from NBDA object</a></li>
<li><a href="#Import-bisonr">Use posterior distribution of edge weights from bayesian network model</a></li>
<li><a href="#Complex-transmission">Modeling complex contagion/transmission - frequency dependent rules</a></li>
</ol>
<div class="section level2">
<h2 id="installation">Installation<a name="Installation"></a>
<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The functions of this package depend on <code>cmdstanr</code>, <code>posterior</code>, <code>bayestestR</code>, <code>data.table</code> and <code>loo</code>. You can install <code>cmdstanr</code> by following these <a href="https://mc-stan.org/cmdstanr/articles/cmdstanr.html" class="external-link">instructions</a>.</p>
<p>Vignettes use packages NBDA (install with <code>devtools::install_github("whoppitt/NBDA"</code>), igraph, dplyr, ggplot2, and ggpubr.</p>
<p>To install the development version of STbayes:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install devtools if not already</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"michaelchimento/STbayes"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a name="Examples"></a>
<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="recover-parameter-values-from-simulated-data">Recover parameter values from simulated data<a name="Recover"></a>
<a class="anchor" aria-label="anchor" href="#recover-parameter-values-from-simulated-data"></a>
</h3>
<p>An example dataset is provided where data was simulated on a random-regular network where k=4, s=5 and the base rate was set to 0.001. You can run your own simulation in the <code>simulate_data.R</code> vignette.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span>
<span><span class="va">event_data</span> <span class="op">=</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">event_data</span></span>
<span><span class="va">edge_list</span> <span class="op">=</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">edge_list</span></span>
<span></span>
<span><span class="co"># import_user_STb formats your data for further steps</span></span>
<span><span class="va">data_list_user</span> <span class="op">=</span> <span class="fu"><a href="reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="va">event_data</span>, <span class="va">edge_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#generate STAN model from input data</span></span>
<span><span class="va">model_obj</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list_user</span>, gq<span class="op">=</span><span class="cn">T</span>, est_acqTime <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list_user</span>, <span class="va">model_obj</span>, chains <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">5</span>, parallel_chains<span class="op">=</span><span class="fl">5</span>, iter<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check estimates</span></span>
<span><span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">fit</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>STb_summary outputs a formatted table of key values for parameters (incl back-transformation of variables fitted on the log scale).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>          Parameter Median   MAD CI_Lower CI_Upper ess_bulk ess_tail  Rhat</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="dv">1</span> log_lambda_0_mean <span class="sc">-</span><span class="fl">6.894</span> <span class="fl">0.448</span>   <span class="sc">-</span><span class="fl">7.832</span>   <span class="sc">-</span><span class="fl">6.065</span> <span class="fl">2623.409</span> <span class="fl">2429.397</span> <span class="fl">1.002</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="dv">2</span>  log_s_prime_mean <span class="sc">-</span><span class="fl">5.366</span> <span class="fl">0.170</span>   <span class="sc">-</span><span class="fl">5.730</span>   <span class="sc">-</span><span class="fl">5.041</span> <span class="fl">2910.030</span> <span class="fl">2599.204</span> <span class="fl">1.002</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="dv">3</span>          lambda_0  <span class="fl">0.001</span> <span class="fl">0.000</span>    <span class="fl">0.000</span>    <span class="fl">0.002</span> <span class="fl">2623.412</span> <span class="fl">2429.397</span> <span class="fl">1.002</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="dv">4</span>                 s  <span class="fl">4.610</span> <span class="fl">2.348</span>    <span class="fl">1.103</span>   <span class="fl">11.798</span> <span class="fl">2339.627</span> <span class="fl">2555.383</span> <span class="fl">1.003</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="dv">5</span>     percent_ST[<span class="dv">1</span>]  <span class="fl">0.819</span> <span class="fl">0.046</span>    <span class="fl">0.716</span>    <span class="fl">0.896</span> <span class="fl">2339.627</span> <span class="fl">2555.383</span> <span class="fl">1.003</span></span></code></pre></div>
<p>Estimates are not far off from the parameter values used for simulation, but depend on network density and stochastic processes of each simulation. See vignette <code>simulate_data_manytimes.R</code> to quench your thirst for model validation.</p>
</div>
<div class="section level3">
<h3 id="compare-full-and-asocial-models">Compare full and asocial models<a name="Compare-full-asocial"></a>
<a class="anchor" aria-label="anchor" href="#compare-full-and-asocial-models"></a>
</h3>
<p>Like NBDA, we can compare a full model with both a social and asocial component, to a model restricted to estimating only an asocial rate. We can compare models using either LOO-PSIS or WAIC with <code>STb_compare</code> (really a convenient wrapper that automates a workflow using package <code>loo</code>) and compare the estimated learning times from both models. First let’s load and fit both models with a convenience function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">event_data</span> <span class="op">=</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">event_data</span></span>
<span><span class="va">edge_list</span> <span class="op">=</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">edge_list</span></span>
<span></span>
<span><span class="co"># format data</span></span>
<span><span class="va">data_list_user</span> <span class="op">=</span> <span class="fu"><a href="reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="va">event_data</span>, <span class="va">edge_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reusable function to generate and fit a model</span></span>
<span><span class="va">generate_and_fit_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">model_type</span>, <span class="va">chains</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">cores</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">parallel_chains</span><span class="op">=</span><span class="fl">5</span>, <span class="va">iter</span> <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data</span>, model_type<span class="op">=</span><span class="va">model_type</span>, est_acqTime <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">chains</span>, <span class="va">cores</span>, <span class="va">iter</span>, <span class="va">control</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># generate, fit, and summarize models</span></span>
<span><span class="va">full_fit</span> <span class="op">=</span> <span class="fu">generate_and_fit_model</span><span class="op">(</span><span class="va">data_list_user</span>, <span class="st">"full"</span><span class="op">)</span></span>
<span><span class="va">asocial_fit</span> <span class="op">=</span> <span class="fu">generate_and_fit_model</span><span class="op">(</span><span class="va">data_list_user</span>, <span class="st">"asocial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#check estimates</span></span>
<span><span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">full_fit</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">asocial_fit</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>We can extract the LOOIC and add them to our plots of the estimated times:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract WAIC and labels</span></span>
<span><span class="va">loo_output</span> <span class="op">=</span> <span class="fu"><a href="reference/STb_compare.html">STb_compare</a></span><span class="op">(</span><span class="va">full_fit</span>, <span class="va">asocial_fit</span>, method<span class="op">=</span><span class="st">"loo-psis"</span><span class="op">)</span></span>
<span><span class="va">looic_full</span> <span class="op">&lt;-</span> <span class="va">loo_output</span><span class="op">$</span><span class="va">loo_objects</span><span class="op">$</span><span class="va">full_fit</span><span class="op">$</span><span class="va">estimates</span><span class="op">[</span><span class="st">"looic"</span>,<span class="op">]</span></span>
<span><span class="va">looic_asocial</span> <span class="op">&lt;-</span> <span class="va">loo_output</span><span class="op">$</span><span class="va">loo_objects</span><span class="op">$</span><span class="va">asocial_fit</span><span class="op">$</span><span class="va">estimates</span><span class="op">[</span><span class="st">"looic"</span>,<span class="op">]</span></span>
<span><span class="va">label_full</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"LOO-PSIS="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">looic_full</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"+/-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">looic_full</span><span class="op">[</span><span class="st">"SE"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">label_null</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"LOO-PSIS="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">looic_asocial</span><span class="op">[</span><span class="st">"Estimate"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"+/-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">looic_asocial</span><span class="op">[</span><span class="st">"SE"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reusable function for plotting</span></span>
<span><span class="va">plot_acq_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">data</span>, <span class="va">title</span>, <span class="va">label</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">acqdata</span> <span class="op">=</span> <span class="fu"><a href="reference/extract_acqTime.html">extract_acqTime</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">data</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">acqdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed_time</span>, y <span class="op">=</span> <span class="va">mean_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">100</span>, y <span class="op">=</span> <span class="fl">350</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed_time</span>, xend <span class="op">=</span> <span class="va">observed_time</span>, y <span class="op">=</span> <span class="va">mean_time</span>, yend <span class="op">=</span> <span class="va">observed_time</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>            title <span class="op">=</span> <span class="va">title</span>,</span>
<span>            x <span class="op">=</span> <span class="st">"Observed time"</span>,</span>
<span>            y <span class="op">=</span> <span class="st">"Estimated time"</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot estimated times</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">plot_acq_time</span><span class="op">(</span><span class="va">asocial_fit</span>, <span class="va">data_list_user</span>, <span class="st">"Asocial (null) model estimates"</span>, <span class="va">label_null</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">plot_acq_time</span><span class="op">(</span><span class="va">full_fit</span>, <span class="va">data_list_user</span>, <span class="st">"Full model estimates"</span>, <span class="va">label_full</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="reference/figures/compare_social_asocial.png" alt="comparison plot"><div class="figcaption">comparison plot</div>
</div>
<p>The full model describes the data much better and obtains a better (lower) LOO-PSIS score. Estimated learning times are the point estimate (mean in this case) from posterior distribution of learning times, and since individuals learn in random orders in the asocial model according to a static rate, the average time of each learner cluster around a similar time. Meanwhile, including time-varying social information allows for a better prediction of when individuals have acquired the behavior.</p>
</div>
<div class="section level3">
<h3 id="import-your-own-data">Import your own data<a name="Import-own"></a>
<a class="anchor" aria-label="anchor" href="#import-your-own-data"></a>
</h3>
<p>If you’d prefer to import your own data, STbayes requires two dataframes, and accept an optional third dataframe of individual-level variables. The first dataframe gives information about the spreading of the behavior or information and must contain columns: - <code>id</code>: Character or numeric (all converted to numeric, anyway) column of individual identites. - <code>trial</code>: Character or numeric column indicating which trial the event belongs to. If there is only one trial, set all values to 1. - <code>time</code>: This is an integer or float column indicating when the individual was recorded as first informed/knowledgable. If an ID was a <strong>pretrained demonstrator, or otherwise became informed prior to the start of the observation period, set as 0</strong>. Left censored individuals will not contribute to the likelihood calculation. If an individual <strong>never learned during the observation period, set its value to the duration of the observation period</strong>. These will be treated as right-censored individuals in the likelihood calculation. - <code>t_end</code>: this is the duration of the observation period for each trial. If you observed a population for 7 days, t_end=7.</p>
<p>The second dataframe gives information regarding the network connections of each individual in a long format (i.e. an edge list). The edge list can be symmetric (all combinations of individuals provided, useful for directed networks) or asymmetric. The first three columns must be: - <code>trial</code>: Character or numeric column indicating which trial the networks belong to. If there is only one diffusion, set all values to 1. - <code>from</code>: Character or numeric column of individual identites. - <code>to</code>: Character or numeric column of individual identites.</p>
<p>Optionally, the user may supply dynamic networks <strong>if time is measured with integer values</strong>. At the moment, the user must organize the data so that each discrete timestep is represented in this dataframe. For example, if your observation period was 7 days, you should supply a network to be used for each day. If the network is a static representation to be used for the entire diffusion, this column is not required. - <code>time</code>: This is an integer column indicating which time step the networks belong to.</p>
<p>Finally, the user must supply at least one descriptively named column of integer or float edge weights. The column names will be carried forward in naming variables in the output of the model. In the example code below, I have provided a binary kin network and an inverse distance network (higher values = closer together). - <code>network_name1</code>: a column of integer or float edge weights - <code>network_name2</code>: another column of integer or float edge weights - etc…</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>   id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span>, <span class="co">#this can be character or numeric</span></span>
<span>   trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co">#this can be character or numeric</span></span>
<span>   time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="co">#this must be numeric, integer or float. If time=0, left-censored, if time&gt;t_end, right-censored</span></span>
<span>   t_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span> <span class="co">#this is the duration of the observation period.</span></span>
<span> <span class="op">)</span></span>
<span> </span>
<span> <span class="va">networks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>   trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co">#this can be character or numeric</span></span>
<span>   from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>, <span class="co">#this can be character or numeric</span></span>
<span>   to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"F"</span><span class="op">)</span>, <span class="co">#this can be character or numeric</span></span>
<span>   kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># first network</span></span>
<span>   inverse_distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.5</span>, <span class="fl">.25</span>, <span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span> <span class="co">#second network</span></span>
<span> <span class="op">)</span></span>
<span> </span>
<span> <span class="co"># optional dataframe of constant individual-level variables</span></span>
<span> <span class="va">ILV_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>   id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>   age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>   sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># Factor ILVs must be input as numeric</span></span>
<span>   weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">.25</span>, <span class="fl">.3</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">.2</span>, <span class="op">-</span><span class="fl">.4</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span> </span>
<span> <span class="co"># optional dataframe of time-varying individual level variables</span></span>
<span> <span class="va">ILV_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># these times correspond to the inter-acquisition periods</span></span>
<span>    <span class="co">#e.g. 1 is from [t_0 to t_1), 2 is [t_1 to t_2), 3 = [t_2 to t_3 or t_end] if censored inds. present)</span></span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co">#ensure the variable is summarizing these inter-acquisition time periods</span></span>
<span>    dist_from_resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span> </span>
<span> <span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span></span>
<span>   event_data <span class="op">=</span> <span class="va">event_data</span>,</span>
<span>   networks <span class="op">=</span> <span class="va">networks</span>,</span>
<span>   ILV_c <span class="op">=</span> <span class="va">ILV_c</span>,</span>
<span>   ILV_tv <span class="op">=</span> <span class="va">ILV_tv</span>,</span>
<span>   ILVi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"dist_from_resource"</span><span class="op">)</span>, <span class="co"># estimate effects of constant ILV 'age' and time-varying ILV 'dist_from_resource' on asocial learning rates</span></span>
<span>   ILVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span><span class="op">)</span>, <span class="co"># Use only 'sex' for social learning</span></span>
<span>   ILVm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span> <span class="co"># Use weight for multiplicative effect on asocial and social learning</span></span>
<span> <span class="op">)</span></span>
<span> </span>
<span> <span class="co">#create the STAN code for the model</span></span>
<span> <span class="va">model_obj</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span> </span>
<span> <span class="co">#Obviously this model will not fit, feed it real data in the format above, or simulate data from the vignette</span></span>
<span> <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model_obj</span>, chains <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">5</span>, parallel_chains<span class="op">=</span><span class="fl">5</span>, iter<span class="op">=</span><span class="fl">2000</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.99</span><span class="op">)</span> <span class="op">)</span></span>
<span> </span>
<span> <span class="co"># You can see a nice summary of the fit here.</span></span>
<span> <span class="co"># parameters are fit on the log scale, but transformations are included in the output</span></span>
<span> <span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">fit</span>, depth<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>If fitting a multinetwork model, network weights will be in the <code>w</code> parameter vector, and you must include depth=2 in the call to STb_summary to see them.</p>
</div>
<div class="section level3">
<h3 id="varying-effects-by-individual">Varying effects by individual<a name="Varying-effects"></a>
<a class="anchor" aria-label="anchor" href="#varying-effects-by-individual"></a>
</h3>
<p>You may apply varying effects for each individual for the baseline rate (lambda_0), the strength of social learning (s) and any of the ILVs. You do this by specifying specific parameter names using the argument <code>veff_ID</code> in the call to <code><a href="reference/generate_STb_model.html">generate_STb_model()</a></code> or <code>generate_STb_asocial_model</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span>, veff_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda_0"</span>, <span class="st">"s"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This can be used if you have multiple trials with the same individuals, and you expect there are consistent individual differences in effects. For lambda_0 and s, varying effects are added onto the main effect prior to transformation from log scale back to linear. For example, if we apply a varying effect for lambda_0, the model will calculate a vector of lambda_0 values for each individual in the <code>transformed parameters</code> block:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mrow><mo>log</mo><msub><mi>λ</mi><mn>0</mn></msub></mrow></msub><mo>+</mo><msub><mi>𝐯</mi><mrow><mtext mathvariant="normal">ID</mtext><mo>,</mo><msub><mi>λ</mi><mn>0</mn></msub></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\exp\left(\mu_{\log \lambda_0} + \boldsymbol{v}_{\text{ID}, \lambda_0}\right)
</annotation></semantics></math></p>
<p>and use those values when calculating the likelihood in the <code>model</code> block. If you specify varying effects and the models have convergence issues, you probably do not have enough data to meaningfully estimate these. For a worked example please see the advanced recipes vignette.</p>
</div>
<div class="section level3">
<h3 id="import-data-from-nbda-object">Import data from NBDA object<a name="Import-NBDA"></a>
<a class="anchor" aria-label="anchor" href="#import-data-from-nbda-object"></a>
</h3>
<p>Create and fit model from NBDA object (taken from Tutorial 4.1 from <a href="https://doi.org/10.1111/1365-2656.13307" class="external-link">Hasenjager et al. 2021</a>). Also see vignette “import_from_nbda_obj.R”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#load example NBDAdata object </span></span>
<span><span class="va">nbdaData_cTADA</span> <span class="op">&lt;-</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">tutorial4_1</span></span>
<span></span>
<span><span class="co">#import into STbayes</span></span>
<span><span class="va">data_list</span> <span class="op">=</span> <span class="fu"><a href="reference/import_NBDA_STb.html">import_NBDA_STb</a></span><span class="op">(</span><span class="va">nbdaData_cTADA</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#generate STAN model from input data</span></span>
<span><span class="va">model_obj</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#fit model</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model_obj</span>, chains <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">5</span>, parallel_chains<span class="op">=</span><span class="fl">5</span>, iter<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">fit</span>, depth<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Fit cTADA model using NBDA tadaFit</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/whoppitt/NBDA" class="external-link">NBDA</a></span><span class="op">)</span></span>
<span><span class="va">model_constant</span><span class="op">&lt;-</span><span class="fu">NBDA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/NBDA/man/tadaFit.html" class="external-link">tadaFit</a></span><span class="op">(</span><span class="va">nbdaData_cTADA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Variable<span class="op">=</span><span class="va">model_constant</span><span class="op">@</span><span class="va">varNames</span>,MLE<span class="op">=</span><span class="va">model_constant</span><span class="op">@</span><span class="va">outputPar</span>,SE<span class="op">=</span><span class="va">model_constant</span><span class="op">@</span><span class="va">se</span><span class="op">)</span></span>
<span><span class="co">#check summary ~ the same as STbayes estimates. the priors on STbayes could be adjusted to be less skeptical of the large s value</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-posterior-distribution-of-edge-weights-from-bayesian-network-model">Use posterior distribution of edge weights from bayesian network model<a name="Import-bisonr"></a>
<a class="anchor" aria-label="anchor" href="#use-posterior-distribution-of-edge-weights-from-bayesian-network-model"></a>
</h3>
<p>Rather than using point estimates for edge weights, it is possible to import posterior distributions of edge weights from bayesian network models, such as those fit by the <a href="https://github.com/JHart96/bisonR/tree/main" class="external-link">bisonr package</a> or the <a href="https://github.com/ctross/STRAND/tree/main" class="external-link">STRAND package</a>. This is done by providing single fits (or a list of fits) to <code><a href="reference/import_user_STb.html">import_user_STb()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">STbayes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load example bisonr fit object</span></span>
<span><span class="va">bisonr_fit</span> <span class="op">=</span> <span class="fu">STbayes</span><span class="fu">::</span><span class="va">bisonr_fit</span></span>
<span></span>
<span><span class="co">#network has 10 individuals, create mock event data</span></span>
<span><span class="va">event_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>   trial <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>   time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">101</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>   t_end <span class="op">=</span> <span class="fl">100</span></span>
<span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#create data_list as usual</span></span>
<span><span class="va">data_list</span> <span class="op">=</span> <span class="fu"><a href="reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="va">event_data</span>, networks<span class="op">=</span><span class="va">bisonr_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># STb detects that you've entered posterior distributions as edgeweights automatically and creates the appropriate model</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#the fit will be garbage because it's made up, but works</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_STb.html">fit_STb</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">model</span>, chains <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">5</span>, parallel_chains<span class="op">=</span><span class="fl">5</span>, iter<span class="op">=</span><span class="fl">2000</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/STb_summary.html">STb_summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modeling-complex-contagiontransmission---frequency-dependent-rules">Modeling complex contagion/transmission - frequency dependent rules<a name="Complex-transmission"></a>
<a class="anchor" aria-label="anchor" href="#modeling-complex-contagiontransmission---frequency-dependent-rules"></a>
</h3>
<p>STbayes can be used to fit and create models of complex transmission. As an example, you can create a log-likelihood that includes a frequency-dependent transmission rule by using the <code>transmission_func</code> argument of <code>generate_STb_model</code>:</p>
<pre><code><span><span class="va">data_list</span> <span class="op">=</span> <span class="fu"><a href="reference/import_user_STb.html">import_user_STb</a></span><span class="op">(</span><span class="fu">STbayes</span><span class="fu">::</span><span class="va">event_data</span>, <span class="fu">STbayes</span><span class="fu">::</span><span class="va">networks</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/generate_STb_model.html">generate_STb_model</a></span><span class="op">(</span><span class="va">data_list</span>, transmission_func<span class="op">=</span><span class="st">"freqdep_f"</span><span class="op">)</span></span></code></pre>
<p>The package defaults to the model of frequency-dependent bias as:</p>
<p><img src="https://latex.codecogs.com/svg.image?%5Cfrac%7B(%5Ctext%7Bn&amp;space;knowledgable&amp;space;associates%7D)%5Ef%7D%7B(%5Ctext%7Bn&amp;space;knowledgeable&amp;space;associates%7D)%5Ef&amp;plus;(%5Ctext%7Bn&amp;space;naive&amp;space;associates%7D)%5Ef)%7D" alt="\frac{(\text{n knowledgeable associates})^f}{(\text{n knowledgable associates})^f&amp;plus;(\text{n naive associates})^f)}"></p>
<p>But also includes an alternative parameterization based on a scaled version of Dino Dini’s normalized tunable sigmoid function. In the first case, f&lt;1 would be evidence of an anti-conformist transmission bias, f=1 would be proportional, and f&gt;1 would be conformist. In the second case, the shape parameter k &lt; 0 is conformist, k=0 proportional, and k&gt;0 anti-conformist. Both parameterizations create a relationship betwen the proportion of neighbors that are knowledgable and the weight of that information on the rate of an event happening for a given individual:</p>
<div class="float">
<img src="reference/figures/complex_transmission.png" alt="dini plot"><div class="figcaption">dini plot</div>
</div>
<p>You might find that one or the other has convergence issues, so we provide both. Complex transmission can be implemented with varying effects, ilvs, oada and ctada type models, etc.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>AGPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing STbayes</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Chimento <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5697-1701" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Chimento.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
